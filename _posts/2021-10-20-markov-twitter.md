---
title: Build a Markov Chain Text Generation Twitter Bot
layout: post
author: tscotn
post-image: /assets/images/blogimages/figs-10-20/cover.png
description: A step-by-step tutorial for building a low-maintenance Python Twitter Bot that tweets only the best statistically-generated gibberish.
tags:
- Twitter
- Python
- Markov Chains
- Text Generation
- Bot
---


## So you want to build a Twitter bot.

For whatever reason, you thought it might be fun to take the social out of social media and make a robot do it. You're in good company; Twitter is full of bots ranging from artsy, to helpful, to downright problematic. I would encourage you to think deeply about the purpose of your bot and only move forward if you're sure it'll have a net benefit on society, or at least just breaks even.

With that out of the way, let's get to it. Check out the bot I made with this tutorial to see what we'll be building:

### [STAT 426 Twitter Bot](https://twitter.com/stat426bot)

---

## Overview

Lucky for us, this is a task with clearly defined steps. There are lots of different kinds of Twitter bots you can make, and it can be a bit more complicated to build one that does anything more advanced than just tweeting, like replying to comments or otherwise interacting with users. Feel free to explore on your own and be creative, but this tutorial will only go over how to make a bot that tweets a generated phrase.

*Please note that these are Mac-specific instructions, but with some googling, each step should be very similar to what you'll need to do if you're on a Windows or Linux machine.*

To reach our goal, we'll have to go through the following steps:

1. Find a corpus from which to generate tweets.
2. Generate tweets with Markovify.
3. Set up a Twitter Developer Account.
4. Write a script to tweet via the Twitter API.
5. Put the script on a timer to tweet at specific intervals.
6. Enjoy fame.

---

## Build a Corpus

A corpus is a source text. It can be a book, a website--anything with words. I've made Twitter bots using quotes from the host of TV's Survivor Jeff Probst, a journalist from The Atlantic, and BYU Speeches, so there are plenty of options to choose from. For this example, we'll be making a Data Science Blog bot and use the other articles on this website as the source corpus. First, I'll need to stitch together all the blogs into one file. Because I have them all in the repo cloned onto my machine, I can use this very simple linux command from the Terminal on Mac:

```python
cat *.md > corpus.md
````

*The cat function concatenates and outputs the content of provided files. \*.md matches all Markdown files in the directory and the ">" operator writes that output into the file I name.*

![Screenshot of corpus file](/assets/images/blogimages/figs-10-20/corpus.png)

This step can also be accomplished by copy-pasting your desired source text from articles, books, etc. into one file. With your corpus file built, we can use Python to generate sentences from this. We'll use the Markovify package for this.

---

## Generating Text with Markov Chains

Text generation can be done using a variety of methods ranging in difficulty and quality of output. We'll stick with an easier method that utilizes [Markov Chains](https://en.wikipedia.org/wiki/Markov_chain), but it should be noted that the quality of your generated text depends heavily on the quality of your corpus. Inane, incomprehensible sentences aren't a sign of something going wrong, that's kinda just the way these work.

There is a lot that you can read about Markov Chains, which are used in modeling applications ranging from animal populations to currency exchange rates. In short, a Markov Chain is a model made up of discrete 'states' which map to outcomes that occur at defined probabilities. It's very similar to a finite state machine, with the difference of probability rather than input defined transitions. For example, a Markov Chain that models the weather might have a raining state, with a certain probability that it continues to rain, a probability that it starts snowing, a probability that it stops raining, etc. In the case of text generation, a Markov Chain creates a sentence word by word using the source corpus as a model. That model is comprised of each and every word in the corpus mapped to any number of outcomes as the word that could potentially follow the first, with the probability that the outcome occurs defined as the proportion of the times that word appears after the first word in the corpus. Whew. Maybe this diagram of the model based on a one-sentence corpus will help:

> "the quick brown fox jumps over the lazy dog."

![Markov Chain visualization of the famous pangram.](/assets/images/blogimages/figs-10-20/pangram.png)

A sentence is generated by following the flowchart adding each word you pass to your sentence in the order you pass it. This sentence obviously doesn't have many words from which to build a model, so generated sentences won't be especially interesting or unique. With a few more sentences, however, the model begins to take a more concrete form. Here's another Markov Chain that represents this quote about Breath of the Wild:

> "This is the new world of Zelda. It is quite a vast world is it not? You can even reach those mountains in the distance, if you walk far enough. We could not create such a wide world like this in the past.

![Breath of the Wild Markov Model.](/assets/images/blogimages/figs-10-20/botw.png)

If you want to do anything more complicated with Text Generation for your Twitter Bot, you might check out [OpenAI](https://openai.com).

To make these models from text in Python, we'll use a package called [Markovify](https://pypi.org/project/markovify). Go ahead and install the package. If you're using pip, you can run the command

```python
pip install markovify
````

The first step when using this package is to build the model from your file. Read your corpus into python and instantiate a Text object from markovify:

```python
import markovify

with open("/path/to/my/corpus.txt") as f:
    text = f.read()

text_model = markovify.Text(text)
```

Now generate a sentence of up to 280 characters (the Twitter character limit) using make_short_sentence(280).

```python
generated_sentence = text_model.make_short_sentence(280)
```

One such sentence generated from the Zelda quote above might look like this:

> 'We could not create such a wide world like this in the distance, if you walk far enough.'

Something that greatly affects the quality of your model is the 'state_size' parameter. This defines the number of words that are included in each state or word group from which the outcome word is predicted. Increasing this parameter will often improve the intelligibility of your sentences. The default state size is 2 words, and the syntax to change it is `markovify.Text(corpus, state_size=3)`. Just remember that the larger you set the state parameter, the closer your generated sentences will look to your corpus sentences. Set this lower if you don't want repeated sentences. Markovify automatically rejects sentences that overlap too much with the corpus so as to not just regurgitate provided content, but after 10 attempt to find a unique sentence it will give up and use whatever it can.

I've built a Markov Chain model using the articles of all other authors on this blog. A few of my favorite sample sentences it generated include:

> 'Through a process of learning a new branch to develop that part of the model trains.'

> 'In addition to all the time. It may say that it is a programming language that will allow you to easily and thus provide more accurate rating system, and then the class, I need to do calculations and make better traffic control decisions.'

> 'After you complete the prerequisites correctly then when you run your program you it will automatically upload your index.html file at a given speed.'

For comparison, these are the kind of sentences I can generate when I set state_size to 1:

>'This library called Matplotlib.'

>'First we want, when I am still in python.'

>"Not only to learn to customer demands, as I've simply start by the turning angle?"

Pretty good, right? In fact, this entire article was generated by a bot trained on thousands of Text Generation blog posts! Just kidding, but that would be cool.

---

## Applying for a Twitter Developer Account

Now that we can generate tweets from our corpus, we need to set up a script to automate tweeting them out. To do this, we'll need access to the Twitter API which allows for these type of operations. It is generally pretty easy to set up an account, but it may take a day or two to get approved.

![Twitter sign up prompt](/assets/images/blogimages/figs-10-20/twitter.png)

Navigate to twitter.com to set up a new account for your bot. The easiest way to do this is by selecting "Sign up with phone or email" and using the email option. If you don't or can't use your personal email to make this account (Twitter doesn't allow multiple accounts on the same email), you can put a '+' sign after your handle and before the '@' sign to create a subaddress that Twitter will accept i.e. /myemail+twitterbot@gmail.com. You'll have to add a bio, profile picture, etc. or skip these options for now.

Now that you have a Twitter account for your bot, we need to upgrade to a developer account at developer.twitter.com. This is free, but requires filling out a few forms to get approval from Twitter. It's a fairly simple process that they use to screen out potentially dangerous bots (think Russian election bots).

At developer.twitter.com, click through Apply > Apply for a developer account > Hobbyist > Making a bot > Get started. It will then require you to add a phone number before proceeding, this number can be associated with multiple accounts. You'll then need to answer questions asked in the form, and may need to resolve follow up emails.

Once you have developer access, navigate to your developer dashboard at developer.twitter.com. Click 'create project', and fill out the form in order to generate authentication keys for your bot. Eventually you'll get to a 'keys and tokens' page. Save the API Key and API Key Secret for writing the script in the next step. Navigate to App Settings, where you'll need to change App Permissions to 'Read and Write'. Click on 'Keys and Tokens', and generate an Access Token and Secret. Save these with the other key and secret.

That was a lot, but these steps should keep your bot secure. Never share these keys publicly. If you ever need to regenerate the user keys, you'll have to update them in your script.

---

## Using the Twitter API

Now that we have access to the Twitter API, we're going to use a Python wrapper called Twython to access it easily. You'll need to generate access tokens and other keys in order to authenticate your API access, this is how Twitter verifies that you have a developer account. Do NOT share these or post these keys anywhere.

In order to set up the wrapper, replace the appropriate field with your keys and tokens in the following code:

```python
from twython import Twython

APP_KEY = 'your key'
APP_SECRET = 'your secret'
ACCESS_TOKEN = 'your token'
ACCESS_SECRET = 'your secret'
twitter = Twython(APP_KEY, APP_SECRET, ACCESS_TOKEN, ACCESS_SECRET)
```

Now to tweet something, you'll just have to call the update_status() method on your Twython object passing in the text to tweet as a status parameter.

```python
twitter.update_status(status=tweet)
```

And that's it! Combine this code with your text generating code to get a short script like this:

```python
from twython import Twython
import markovify

APP_KEY = ''
APP_SECRET = ''
ACCESS_TOKEN = ''
ACCESS_SECRET = ''
twitter = Twython(APP_KEY, APP_SECRET, ACCESS_TOKEN, ACCESS_SECRET)

with open("corpus.md") as f:
    text = f.read()

text_model = markovify.Text(text)
tweet = text_model.make_short_sentence(280)

twitter.update_status(status=tweet)
```

And that's it! Run the script now and check twitter to see if your tweet sent successfully.

---

## Scheduling your tweets

The last thing we to do is to put our script on a timer. Crontab is an excellent tool for scheduling scripts to run at a certain time, the only caveat is that your computer will need to be awake at the time you specify, so choose a time when that is most likely to be true. I recommend reading more about it at [this website](https://ole.michelsen.dk/blog/schedule-jobs-with-crontab-on-mac-osx/).

We'll access Crontab through the command line by running this command in your computer's terminal:

```
env EDITOR=nano crontab -e
```

This opens up Crontab to be edited, using nano as the editor. In the editor, type this code, replacing the path with your script.

`0 12 * * *  /path/to/script/markov_twitter.py`

The numbers and asterisks before the path represent time intervals in cron syntax. This particular code means that the script will run at noon every day. If you'd like to edit the timing or change the frequency, check out [crontab guru](https://crontab.guru).

It may take some trial and error to get working correctly to ensure you have the correct filepath, and you'll likely need to change the permissions on your script to allow crontab to run it by executing code like this:

`chmod u+rwx markov_twitter.py`

Note that you can also set up a raspberry pi to run cron jobs, if you'd rather not have to remember to wake your computer up at the right time each day.

---

## Conclusion

At this point, we've been through a lot together. We've built a corpus of text, used markov chains to generate sentences from it, connected to the Twitter API, tweeted using a python script, and put it all on a timer. Feel free to comment with any bot ideas or links to bots you make!
